# 01 动手题
1. 我们项目消费消息也是用的模版设计模式
2. 可以用在项目的缓存使用上，我们项目缓存使用如下
    1. 使用 redis 作为缓存，数据一定在 db 中有一份
    2. 先查 redis ，如果 redis 中查不到，则查 db，查询后将数据缓存至 redis 中，最后返回数据

查询 redis 缓存，和未命中缓存 load db 的逻辑其实是固定的，故可以使用模版设计模式

这种设计模式的优点：
1、利用模板方法将相同处理逻辑的代码放到抽象父类中，可以提高代码的复用性。 
2、将不同的代码不同的子类中，通过对子类的扩展增加新的行为，提高代码的扩展性。 
3、把不变的行为写在父类上，去除子类的重复代码，提供了一个很好的代码复用平台，符合开闭原则。

# 02 思考题
之前遇到一个场景出现过消息先发后达的情况

1. 场景描述
   业务模型：先购买装扮，购买成功后发虚拟币
   
   对于消息：购买虚拟币的订单完成消息和购买装扮的订单完成消息两条消息
   业务状态：购买装扮成功:1，发放虚拟币成功:2
   
   正常流程：先收到购买装扮的订单完成消息，将数据库状态置为1 (购买装扮成功)，然后收到发放虚拟币成功消息将数据库置为 2 （发放虚拟币成功）
   
   异常流程：先收到在收到购买装扮消息后，还未更新数据库，就收到了虚拟币订单成功消息，导致数据库状态字段直接更新为 2（发放虚拟币成功），后续在购买装扮消息中流程结束，又将数据库状态字段覆盖成了 1 (购买装扮成功)，导致数据库状态更新异常

2. 解决方式
    更新数据库状态的时候，假如是最终状态，则不更新数据库状态，仅写入业务信息